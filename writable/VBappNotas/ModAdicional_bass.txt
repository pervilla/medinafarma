Public Pub_ConnAdo As New ADODB.Connection
Public StockC1  As String * 10
Public StockC2  As String * 10
Public StockC3  As String * 10
Public StockC4  As String * 10
Public StockC5  As String * 10
Public StockC6  As String * 10
Public StockC7  As String * 10
Public pub_puerto As String * 1
Public pu_sintoma As Integer
Public PUB_CC_VENTA As String * 1
Public PUB_CC_FUFE As String * 1
Public pub_codvenrel As String



Public Sub LlenadoCbo(ByVal cbo As ComboBox, ByVal TIPREG As Integer)
Dim CONTA As Integer
    CONTA = -1
    PUB_TIPREG = TIPREG
    PUB_CODCIA = LK_CODCIA
    If LK_EMP_PTO = "A" Then
       PUB_CODCIA = "00"
    End If
    SQ_OPER = 2
    LEER_TAB_LLAVE
    cbo.ToolTipText = "TAB_TIPREG = " & TIPREG
    cbo.Clear
    Do Until tab_mayor.EOF
        cbo.AddItem tab_mayor!TAB_NOMLARGO & String(80, " ") & tab_mayor!TAB_NUMTAB
        CONTA = CONTA + 1
        tab_mayor.MoveNext
    Loop
End Sub

Public Sub BuscaInCbo(WCONTROL As ComboBox, txt As Integer)
Dim C As Integer
    For C = 0 To WCONTROL.ListCount - 1
        If Val(Trim(Right(WCONTROL.List(C), 6))) = txt Then
            WCONTROL.ListIndex = C
            Exit Sub
        End If
    Next C
    WCONTROL.ListIndex = -1
End Sub

Public Function vString(K As Integer) As Integer
Dim sCaracter As String
Dim cE As Integer
sCaracter = UCase(Chr(K))
cE = InStr(1, "áéíóúñÁÉÍÓÚÑ", sCaracter)
    If ((K <= 123 And K >= 97) Or (K <= 90 And K >= 65)) Or K = 32 Or K = 8 Or cE > 0 Then
        vString = K
    Else
        vString = 0
    End If
End Function
Public Function vInteger(K As Integer) As Integer
Dim cE As Integer
Dim sCaracter As String
sCaracter = Chr(K)
cE = InStr(1, "0123456789", sCaracter)
    If cE > 0 Or K = 8 Then
        vInteger = K
    Else
        vInteger = 0
    End If
End Function
Public Function vNumeric(K As Integer) As Integer
Dim cE As Integer
Dim sCaracter As String
sCaracter = Chr(K)
cE = InStr(1, "0123456789.", sCaracter)
    If cE > 0 Or K = 8 Then
        vNumeric = K
    Else
        vNumeric = 0
    End If
End Function

Public Function OpenSQLForwardOnly(ByVal strSP As String) As ADODB.Recordset
    On Error GoTo ErrHandler
    
    ' Create the ADO objects
    Dim rs As ADODB.Recordset, cmd As ADODB.Command
    Set rs = New ADODB.Recordset
    Set cmd = New ADODB.Command
    
    ' Init the ADO objects  & the stored proc parameters
    cmd.ActiveConnection = Pub_ConnAdo
    cmd.CommandText = strSP
    cmd.CommandType = adCmdText
    
    rs.CursorLocation = adUseClient
    rs.Open cmd, , adOpenForwardOnly
    
    Set cmd.ActiveConnection = Nothing
    Set cmd = Nothing
    Set rs.ActiveConnection = Nothing
    
    Set OpenSQLForwardOnly = rs
    Exit Function

ErrHandler:
    Set OpenSQLForwardOnly = Nothing
    Set rs = Nothing
    Set cmd = Nothing
    MsgBox Err.Description, vbCritical, Pub_Titulo
End Function

Public Function SALDOCAJAGEN(WCODCAJA As Integer, WMON As String, Optional OPWCODCIA) As Currency
SALDOCAJAGEN = 0
Dim flag_mst_caja As String
Dim wvalor As String
Dim WFLAG_MODICAJA As String * 1
Dim ws_conta As Integer
Dim WS_NOMCLI As String * 20
Dim WS_NOMBAN As String * 20
Dim WS_SALDO As Currency
Dim WS_MONEDA As String * 1
Dim ww_moneda
Dim ws_mensaje
Dim WS_FBG, WS_LARGO, ws_nomche, ws_codclie
Dim WS_SALDO_ING As Currency
Dim WS_SALDO_SAL As Currency
Dim todos_cli
Dim wsFECHA1

If Not IsMissing(OPWCODCIA) Then
PUB_CODCIA = OPWCODCIA
Else
PUB_CODCIA = LK_CODCIA
End If
wsFECHA1 = LK_FECHA_DIA
WS_SALDO = 0
WS_MONEDA = WMON
PUB_FECHA = wsFECHA1
SQ_OPER = 1
pu_codcia = PUB_CODCIA
LEER_ALL_LLAVE
If all_llave.EOF Then GoTo VAMOS
If WS_MONEDA = "S" Then
     If Val(WCODCAJA) <> 0 Then
       If WCODCAJA = 1 Then
         WS_SALDO = Val(all_llave!ALL_IMPG1)
       ElseIf WCODCAJA = 2 Then
         WS_SALDO = Val(all_llave!ALL_IMPG2)
       ElseIf WCODCAJA = 3 Then
         WS_SALDO = Val(all_llave!ALL_GASTOS)
       End If
     Else
       WS_SALDO = all_llave!ALL_IMPORTE
     End If
Else
     WS_SALDO = all_llave!ALL_IMPORTE_DOLL
End If
all_llave.MoveNext
Do Until all_llave.EOF
   If all_llave!ALL_signo_caja = 0 Then GoTo OTRO
   If Val(WCODCAJA) <> 0 Then
       If Val(WCODCAJA) <> Nulo_Valor0(all_llave!all_CODCAJ) Then GoTo OTRO
   End If
   If LK_EMP = "HER" And all_llave!ALL_CODTRA = 2727 And all_llave!ALL_SIGNO_CAR = 1 Then GoTo OTRO
   If all_llave!all_flag_ext = "E" Then GoTo OTRO
   If Trim(all_llave!ALL_moneda_ccm) <> " " And Val(all_llave!all_codban) <> 0 Then
      ww_moneda = all_llave!ALL_moneda_ccm
   ElseIf Trim(all_llave!ALL_MONEDA_CLI) <> " " And Val(all_llave!ALL_CODCLIE) <> 0 Then
      ww_moneda = all_llave!ALL_MONEDA_CLI
   ElseIf Trim(all_llave!ALL_MONEDA_CAJA) <> " " Then
      ww_moneda = all_llave!ALL_MONEDA_CAJA
   End If
   If ww_moneda <> WS_MONEDA Then GoTo OTRO
   
   If all_llave!ALL_SIGNO_CAR = 0 And all_llave!ALL_tipmov = 0 Then
      WS_IMPORTE = all_llave!ALL_IMPORTE
   Else
      WS_IMPORTE = all_llave!ALL_IMPORTE_AMORT
   End If
   If all_llave!ALL_SIGNO_CAR = -1 And all_llave!ALL_CODTRA = 2727 And all_llave!ALL_signo_caja = 1 Then
        WS_IMPORTE = all_llave!ALL_IMPORTE_AMORT
   End If
   
   WS_SALDO = WS_SALDO + WS_IMPORTE * Val(all_llave!ALL_signo_caja)
   GoTo AVAMCECAJA2
OTRO:
AVAMCECAJA2:
  all_llave.MoveNext
Loop
SALDOCAJAGEN = WS_SALDO
VAMOS:
End Function

Public Function Presup_Oper(po_aviso As Integer, po_codtra As Integer, po_secuencia As Integer, po_fecha As Date, po_centroc As Integer) As Boolean
Dim wresp As Currency
Dim wfec1 As String
Dim wfec2 As String
Dim wano As String
Dim wmes As String
Dim wdias As String
Dim wpo_impacu As Currency
Dim wpo_presup As Currency
Dim wpo_estado As String
Dim wpo_periodo As String
Dim wpo_importeoper As Currency
If FORMGEN.i_cc.Visible = False Then
   Presup_Oper = True
   Exit Function
End If
If po_codtra = 2741 Or po_codtra = 5355 Or po_codtra = 5714 Or po_codtra = 5360 Or po_codtra = 2426 Or po_codtra = 5340 Or po_codtra = 2412 Or po_codtra = 2410 Then
Else
   Presup_Oper = True
   Exit Function
End If
If po_codtra = 2741 Then
  If po_secuencia >= 30 And po_secuencia <= 39 Then
  ElseIf po_secuencia >= 12 And po_secuencia <= 15 Then
  Else
    Presup_Oper = True
    Exit Function
  End If
End If
wpo_periodo = Format(po_fecha, "mmyyyy")

GoSub arma_fecha
pub_cadena = "select mpr_monto, mpr_adicional, mpr_estado from mpresup where MPR_CODCIA = '" & LK_CODCIA & "' AND MPR_PERIODO = '" & wpo_periodo & "' AND MPR_CODTRA = " & po_codtra & " And MPR_SEC = " & po_secuencia & " And MPR_CENTROC = " & po_centroc
Set X = CN.OpenResultset(pub_cadena, rdOpenKeyset, rdConcurValues) ' rdConcurReadOnly) ', rdConcurLock)
If Not X.EOF Then
  wpo_presup = Val(Nulo_Valor0(X!mpr_monto)) + Val(Nulo_Valor0(X!mpr_adicional))
  wpo_estado = Trim(X!mpr_ESTADO)
Else
  wpo_presup = 0
  wpo_estado = "E"
End If
If wpo_estado = "E" Then
  If po_aviso = 0 Then
     MsgBox "La Condicion de Gasto, No definida en el Presupuesto, No procede la operación ", 48, Pub_Titulo
     Presup_Oper = False
     Exit Function
  End If
End If

If po_codtra = 2412 Then
    pub_cadena = "select  sum(all_importe_amort) as ImpEje from allog where all_codcia = '" & LK_CODCIA & "' and all_fecha_dia >= '" & Format(wfec1, "dd/mm/yyyy") & "' and all_fecha_dia <= '" & Format(wfec2, "dd/mm/yyyy") & "' and  all_secuencia = " & Val(po_secuencia) & " and all_codtra = '" & po_codtra & "' and all_flag_ext <> 'E' and all_cc = " & po_centroc & "  "
    wpo_importeoper = Val(FORMGEN.i_importe_amort.Text)
Else
    If LK_CODTRA = 2748 Or LK_CODTRA = 5355 Then
    pub_cadena = "select  sum(all_importe) as ImpEje from allog where all_codcia = '" & LK_CODCIA & "' and all_fecha_dia >= '" & Format(wfec1, "dd/mm/yyyy") & "' and all_fecha_dia <= '" & Format(wfec2, "dd/mm/yyyy") & "' and  all_secuencia = " & Val(po_secuencia) & " and all_codtra in ('5355','2748') and all_flag_ext <> 'E' and all_cc = " & po_centroc & "  "
    Else
    pub_cadena = "select  sum(all_importe) as ImpEje from allog where all_codcia = '" & LK_CODCIA & "' and all_fecha_dia >= '" & Format(wfec1, "dd/mm/yyyy") & "' and all_fecha_dia <= '" & Format(wfec2, "dd/mm/yyyy") & "' and  all_secuencia = " & Val(po_secuencia) & " and all_codtra = '" & po_codtra & "' and all_flag_ext <> 'E' and all_cc = " & po_centroc & "  "
    End If
    If po_codtra = 2741 Or LK_CODTRA = 2748 Then
       wpo_importeoper = Val(FORMGEN.i_importe_amort.Text)
    Else
      wpo_importeoper = Val(FORMGEN.i_importe.Text)
    End If
End If
Set X = CN.OpenResultset(pub_cadena, rdOpenKeyset, rdConcurValues) ' rdConcurReadOnly) ', rdConcurLock)
wpo_impacu = wpo_importeoper
If X.EOF Then
  wpo_impacu = wpo_impacu + 0
Else
  wpo_impacu = wpo_impacu + Format(Nulo_Valor0(X!ImpEje), "0.00")
End If
If po_aviso = 0 Then
 If wpo_presup = 0 Then
    MsgBox "Este Tipo de Gasto No tiene Presupuesto, No procede la operación ", 48, Pub_Titulo
    Presup_Oper = False
    Exit Function
 ElseIf wpo_impacu > wpo_presup Then
     MsgBox "Monto Supera a lo presupuestado, No procede la operación ", 48, Pub_Titulo
     Presup_Oper = False
      Exit Function
 End If

End If
Presup_Oper = True
Exit Function
arma_fecha:
wano = Right(wpo_periodo, 4)
wmes = Left(wpo_periodo, 2)
wfec1 = "01/" & wmes & "/" & wano
If wmes = 1 Then wdias = 31
If wmes = 2 Then
   wresp = Val(Val(wano / 4)) - Val(Int(Val(wano / 4)))
   If Val(wresp) = 0 Then
     wdias = 29
   Else
     wdias = 28
   End If
End If
If wmes = 3 Then wdias = 31
If wmes = 4 Then wdias = 30
If wmes = 5 Then wdias = 31
If wmes = 6 Then wdias = 30
If wmes = 7 Then wdias = 31
If wmes = 8 Then wdias = 31
If wmes = 9 Then wdias = 30
If wmes = 10 Then wdias = 31
If wmes = 11 Then wdias = 30
If wmes = 12 Then wdias = 31

wfec2 = wdias & "/" & wmes & "/" & wano
Return

End Function

Public Sub IA_General()
Screen.MousePointer = 13
MDIForm1.Reportes.Connect = PUB_ODBC
MDIForm1.Reportes.Destination = crptToWindow  '= crptToPrinter
MDIForm1.Reportes.WindowLeft = 350
MDIForm1.Reportes.WindowTop = 70
MDIForm1.Reportes.WindowWidth = 435
MDIForm1.Reportes.WindowHeight = 490
MDIForm1.Reportes.Formulas(1) = ""
MDIForm1.Reportes.WindowTitle = "PRECIOS"
MDIForm1.Reportes.ReportFileName = PUB_RUTA_OTRO + "IA_precios.RPT"
pub_cadena = "{ARTI.ART_CODCIA} = '" & LK_CODCIA & "' AND {ARTICULO.ARM_CODCIA} = '" & LK_CODCIA & "' AND {PRECIOS.PRE_CODCIA} = '" & LK_CODCIA & "'"
MDIForm1.Reportes.SelectionFormula = pub_cadena
MDIForm1.Reportes.WindowTitle = MDIForm1.Reportes.WindowTitle & " Archivo: " & Trim(MDIForm1.Reportes.ReportFileName)
MDIForm1.Reportes.Action = 1
Screen.MousePointer = 0
End Sub

Public Sub CosteoOnLine(ol_Tipo As String, ol_AddLst As String, ol_Cias As String, ol_MultiCias As String, ol_CodArt As String, ol_CodFami As Currency, ol_Fecha_ini As Date, ol_tipmov As Integer, ol_numser As Integer, ol_fbg As String, ol_numfac As Currency, ol_barraprinci As ProgressBar, ol_barraDet As ProgressBar, ol_msg As Label, ol_inicial As Currency)
'=== Variables ====
Dim WONL_CADE As String
Dim ol_RegProductos As rdoResultset
Dim ol_RegDetalle As rdoResultset
Dim ol_RegInicial As rdoResultset
Dim wol_cospro_ant As Currency
Dim wol_cantidad_ant As Currency
Dim wol_stock_ant As Currency
Dim msg1 As String
Dim msg2 As String
'==================
If ol_AddLst = "A" Then
    pub_cadena = "DELETE FROM NEWPRECIOS WHERE PRE_CODCIA = '" & LK_CODCIA & "'"
    CN.Execute pub_cadena, rdExecDirect
End If
If ol_Tipo = "D" Then ' x Documento
  pub_cadena = "SELECT DISTINCT FAR_CODART AS CODIGO_PROD FROM FACART WHERE FAR_CODCIA IN ('" & LK_CODCIA & "') AND FAR_TIPMOV = '" & ol_tipmov & "' AND FAR_NUMSER = '" & ol_numser & "' AND FAR_FBG = '" & ol_fbg & "' AND FAR_NUMFAC = '" & ol_numfac & "' AND FAR_ESTADO <> 'E' GROUP BY FAR_CODART "
  Set ol_RegProductos = CN.OpenResultset(pub_cadena, rdOpenKeyset, rdConcurValues) ' rdConcurReadOnly) ', rdConcurLock)
ElseIf ol_Tipo = "P" Then ' x Producto
  pub_cadena = "SELECT DISTINCT ART_KEY AS CODIGO_PROD FROM ARTI WHERE ART_KEY <> 0 AND  ART_CODCIA IN " & ol_Cias & " AND ART_KEY IN " & ol_CodArt & " "
  Set ol_RegProductos = CN.OpenResultset(pub_cadena, rdOpenKeyset, rdConcurValues) ' rdConcurReadOnly) ', rdConcurLock)
ElseIf ol_Tipo = "T" Then ' x Todos los productos
  pub_cadena = "SELECT DISTINCT ART_KEY AS CODIGO_PROD FROM ARTI WHERE ART_KEY <> 0  AND ART_CODCIA IN " & ol_Cias & " AND ART_SITUACION <> '1' ORDER BY ART_KEY "
  Set ol_RegProductos = CN.OpenResultset(pub_cadena, rdOpenKeyset, rdConcurValues) ' rdConcurReadOnly) ', rdConcurLock)
  If ol_inicial <> 0 Then ol_RegProductos.AbsolutePosition = ol_inicial
ElseIf ol_Tipo = "L" Then ' x Linea
  pub_cadena = "SELECT DISTINCT ART_KEY AS CODIGO_PROD FROM ARTI WHERE ART_KEY <> 0  AND ART_CODCIA IN " & ol_Cias & " AND ART_FAMILIA = " & ol_CodFami & " AND ART_SITUACION <> '1' ORDER BY ART_KEY "
  Set ol_RegProductos = CN.OpenResultset(pub_cadena, rdOpenKeyset, rdConcurValues) ' rdConcurReadOnly) ', rdConcurLock)
Else
  Exit Sub
End If
If ol_RegProductos.EOF Then Exit Sub
WONL_CADE = ""
ol_barraprinci.Max = ol_RegProductos.RowCount
ol_barraprinci.Min = 0
ol_barraprinci.Value = 0
ol_barraprinci.Visible = True
DoEvents
ol_barraDet.Visible = True
DoEvents
Do Until ol_RegProductos.EOF
    msg1 = "Cod. Productos: " & ol_RegProductos!CODIGO_PROD & " de " & ol_RegProductos.AbsolutePosition & " / " & ol_RegProductos.RowCount
    ol_barraprinci.Value = ol_barraprinci.Value + 1
    ol_msg.Caption = msg1
    DoEvents
    ' calculo el Stock incial
    
    pub_cadena = "SELECT SUM(FAR_CANTIDAD * FAR_SIGNO_ARM) AS SALDO  FROM FACART " & _
    "WHERE FAR_CODCIA IN " & ol_Cias & " AND " & _
    "FAR_CODART = " & ol_RegProductos!CODIGO_PROD & " AND FAR_FECHA_COMPRA < '" & Format(ol_Fecha_ini, "dd/mm/yyyy") & "' and " & _
    "Far_estado <> 'E' and Far_estado2 <>'L' and Far_transito <> 'P' "
    Set ol_RegInicial = CN.OpenResultset(pub_cadena, rdOpenKeyset, rdConcurValues) ' rdConcurReadOnly) ', rdConcurLock)
    If ol_RegInicial.EOF Then
        wol_stock_ant = 0
        wol_saldo = 0
    Else
        wol_saldo = Nulo_Valor0(ol_RegInicial!saldo)
        wol_stock_ant = wol_saldo
    End If
'    If ol_RegProductos!CODIGO_PROD = 1164412 Then Stop
    ' calculo el CostoPromedio incial
    pub_cadena = "SELECT TOP 1 * FROM FACART " & _
    "WHERE FAR_CODCIA IN " & ol_Cias & " AND " & _
    "FAR_CODART = " & ol_RegProductos!CODIGO_PROD & " AND FAR_FECHA_COMPRA < '" & Format(ol_Fecha_ini, "dd/mm/yyyy") & "' and " & _
    "far_estado <> 'E' and far_estado2 <>'L' and far_transito <> 'P' " & _
    "ORDER BY FAR_FECHA_COMPRA DESC, FAR_SIGNO_ARM ASC,FAR_TIPMOV DESC, FAR_NUMOPER2 DESC ,FAR_CODCIA DESC"
    Set ol_RegInicial = CN.OpenResultset(pub_cadena, rdOpenKeyset, rdConcurValues) ' rdConcurReadOnly) ', rdConcurLock)
    If ol_RegInicial.EOF Then
        wol_cospro_ant = 0
        wol_Valor_ant = 0
        wol_cospro = 0
    Else
        'Debug.Print ol_RegInicial!FAR_codcia & ol_RegInicial!FAR_tipmov & ol_RegInicial!FAR_numfac
        
        wol_cospro_ant = ol_RegInicial!FAR_COSPRO ' _ANT
        wol_Valor_ant = 0
        wol_cospro = ol_RegInicial!FAR_COSPRO
    End If
    
    pub_cadena = "SELECT * FROM FACART " & _
    "WHERE FAR_CODCIA IN " & ol_Cias & " AND " & _
    "FAR_CODART = " & ol_RegProductos!CODIGO_PROD & " AND FAR_FECHA_COMPRA >= '" & Format(ol_Fecha_ini, "dd/mm/yyyy") & "' and " & _
    "far_estado <> 'E' and far_estado2 <>'L' and far_transito <> 'P' " & _
    "ORDER BY FAR_FECHA_COMPRA, FAR_SIGNO_ARM DESC ,FAR_TIPMOV, FAR_NUMOPER2,FAR_CODCIA "
    Set ol_RegDetalle = CN.OpenResultset(pub_cadena, rdOpenKeyset, rdConcurValues) ' rdConcurReadOnly) ', rdConcurLock)
    If Not ol_RegDetalle.EOF Then
      ol_barraDet.Max = ol_RegDetalle.RowCount
      ol_barraDet.Min = 0
      ol_barraDet.Value = 0
    End If
    Do Until ol_RegDetalle.EOF
        msg2 = Chr(13) & "Costeando Registros " & ol_RegDetalle.AbsolutePosition & " / " & ol_RegDetalle.RowCount
        ol_barraDet.Value = ol_barraDet.Value + 1
        ol_msg.Caption = msg1 & msg2
        DoEvents
        wol_saldo = wol_saldo + (ol_RegDetalle!FAR_cantidad * ol_RegDetalle!far_signo_arm)
        If ol_RegDetalle!FAR_tipmov = 103 And ol_RegDetalle!FAR_cantidad = 0 Then   ' recalculo de costo vs STOCK
           wol_Valor = Format(ol_RegDetalle!FAR_PRECIO, "0.0000") * -1
           wol_Valor_ant = Format((wol_saldo + (ol_RegDetalle!FAR_cantidad * ol_RegDetalle!far_signo_arm) * -1) * wol_cospro_ant, "0.0000")
           If Val(wol_saldo) <= 0 Then
              WONL_CADE = WONL_CADE & ", " & ol_RegDetalle!far_codart
              GoTo AVAN_COD
           End If
           wol_cospro = Format((Val(wol_Valor_ant) + Val(wol_Valor)) / Val(wol_saldo), "0.0000")
        End If
        If ol_RegDetalle!FAR_tipmov = 6 And ol_RegDetalle!FAR_NUM_LOTE = 50 Then GoTo ENRACOSTEO
        If (ol_RegDetalle!FAR_tipmov = 20 Or ol_RegDetalle!FAR_tipmov = 93 Or ol_RegDetalle!FAR_tipmov = 22) And ol_RegDetalle!FAR_COSTEO = "A" Then
ENRACOSTEO:
           wol_Valor = Format((ol_RegDetalle!FAR_cantidad / ol_RegDetalle!FAR_equiv) * ol_RegDetalle!FAR_PRECIO, "0.0000")
           wol_Valor = Format(Val(wol_Valor) - Val(ol_RegDetalle!FAR_DESCTO) + Val(ol_RegDetalle!FAR_FLETE), "0.0000")
           wol_Valor_ant = Format((wol_saldo + (ol_RegDetalle!FAR_cantidad * ol_RegDetalle!far_signo_arm) * -1) * wol_cospro_ant, "0.0000")
           If Val(wol_saldo) <= 0 Then
              WONL_CADE = WONL_CADE & ", " & ol_RegDetalle!far_codart
              GoTo AVAN_COD
           End If
           wol_cospro = Format((Val(wol_Valor_ant) + Val(wol_Valor)) / Val(wol_saldo), "0.0000")
        End If
        ol_RegDetalle.Edit
        ol_RegDetalle!FAR_FLAG_SO = "K"
        ol_RegDetalle!FAR_COSPRO = wol_cospro
        ol_RegDetalle!far_cospro_sup = wol_cospro_ant
        ol_RegDetalle!FAR_COSPRO_ANT = wol_cospro_ant
        ol_RegDetalle!FAR_STOCK = wol_saldo
        ol_RegDetalle.Update
        wol_Valor_ant = wol_Valor
        wol_cospro_ant = wol_cospro
      ol_RegDetalle.MoveNext
    Loop
    If ol_AddLst = "A" Then
        pub_cadena = "SELECT TOP 1 ARM_COSPRO  FROM ARTICULO  WHERE ARM_CODART = " & ol_RegProductos!CODIGO_PROD & " AND ARM_CODCIA IN " & ol_Cias & " "
        Set X = CN.OpenResultset(pub_cadena, rdOpenKeyset, rdConcurValues) ' rdConcurReadOnly) ', rdConcurLock)
        Frmcospro.actualizar_precio ol_RegProductos!CODIGO_PROD, Val(wol_cospro), X!ARM_COSPRO
    End If
    pub_cadena = "UPDATE ARTICULO SET ARM_COSPRO = " & wol_cospro & " WHERE ARM_CODCIA IN " & ol_Cias & " AND ARM_CODART = " & ol_RegProductos!CODIGO_PROD
    CN.Execute pub_cadena
AVAN_COD:
ol_RegProductos.MoveNext
Loop
ol_barraprinci.Visible = False
DoEvents
ol_barraDet.Visible = False
DoEvents
ol_msg.Caption = ""
If Trim(WONL_CADE) <> "" Then MsgBox "Codigos de Productos con Stock en negativo NO SE COSTEARON:" & Chr(13) & WONL_CADE, 48, Pub_Titulo


End Sub





